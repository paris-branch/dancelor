<script type="text/javascript" src="/dancelor/compose.js"></script>

<!-- <form>
  <script type="text/javascript">
    /* List of all the tunes in the database */

    var allTunes = [];

    fetch('/api/tune/all')
    .then(function (response) {
	return response.json();
    })
    .then(function (json) {
	allTunes = json['tunes'];
    });

    /* List of the tunes in the set */

    function tuneFromSlug (slug) {
	return allTunes.find(function (tune) {
	    return (tune['slug'] == slug);
	});
    }

    function searchTune () {
	var input = document.getElementById('search').value;

	var searchResultsHTML = '<table>';
	allTunes.forEach(function (tune) {
	    if (~ tune['group']['name'].toLowerCase().indexOf(input.toLowerCase())) {
		searchResultsHTML
		    += '<tr>'
		    +    '<td>' + tune['score'] + '</td>'
		    +    '<td>' + tune['group']['name'] + '</td>'
		    +    '<td>' + tune['bars'] + ' ' + tune['group']['kind'] + '</td>'
		    +    '<td>' + tune['structure'] + '</td>'
		    +    '<td><a href="#" onClick="addTune(\'' + tune['slug'] + '\');">Add</a></td>'
		    +  '</tr>';
	    }
	});
	searchResultsHTML += '</table>';
	document.getElementById('searchResults').innerHTML = searchResultsHTML;
    }

    function save () {
	var name = document.getElementById('name').value;
	var kind = document.getElementById('kind').value;

	var uri = '/api/set/save'
	    + '?name=' + encodeURIComponent(name)
	    + '&kind=' + encodeURIComponent(kind);
	tunes.forEach(function (tune) {
	    uri += '&tunes=' + tune['slug'];
	});

	fetch(uri)
	    .then(function (response) {
		return response.json();
	    })
	    .then(function (json) {
		window.location.href = json['set']['link'];
	    });
    }

    // ======================== Register events ======================== //

    document.getElementById('search').addEventListener("keyup", function (event) {
	//if (event.key === 'Enter') {
	    searchTune();
	//}
    });
    searchTune();
  </script>
</form> -->
